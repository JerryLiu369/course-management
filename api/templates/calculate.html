<!DOCTYPE html>
<html>
<head>
    <meta charSet="utf-8"/>
    <title>计算学分</title>
    <meta name="viewport" content="width=device-width"/>
    <meta name="next-head-count" content="2"/>
    <link rel="preload" href="../static/_next/static/css/f6fb3ae35ce38808.css" as="style" crossorigin=""/>
    <link rel="stylesheet" href="../static/_next/static/css/f6fb3ae35ce38808.css" crossorigin="" data-n-p=""/>
    <style>
        .large-checkbox {
            width: 18px;  /* 或其他期望的大小 */
            height: 18px; /* 或其他期望的大小 */
        }
    </style>
    <noscript data-n-css=""></noscript>
    <script defer="" crossorigin="" nomodule="" src="../static/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script>
    <script src="../static/_next/static/chunks/webpack-2a87ebd0c1789c14.js" defer="" crossorigin=""></script>
    <script src="../static/_next/static/chunks/framework-c32ecadf14a0e484.js" defer="" crossorigin=""></script>
    <script src="../static/_next/static/chunks/main-21b4e53e06df30e4.js" defer="" crossorigin=""></script>
    <script src="../static/_next/static/chunks/670-f216f4c09f13ddf1.js" defer="" crossorigin=""></script>
    <script src="../static/_next/static/chunks/47-6c96a0ebeb4ed6d8.js" defer="" crossorigin=""></script>
    <script src="../static/_next/static/1zzyugYDExpvqP4ahtYCX/_buildManifest.js" defer="" crossorigin=""></script>
    <script src="../static/_next/static/1zzyugYDExpvqP4ahtYCX/_ssgManifest.js" defer="" crossorigin=""></script>
</head>
<body>
<div id="__next">
    <div class="grid min-h-screen w-full grid-cols-[280px_1fr]">
        <nav class="hidden border-r bg-gray-100/40 lg:block dark:bg-gray-800/40">
            <div class="flex h-full max-h-screen flex-col gap-2">
                <div class="flex h-[60px] items-center border-b px-6"><a class="flex items-center gap-2 font-semibold"
                                                                         href="/general">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    <span>培养方案制定工具 </span></a></div>
                <div class="flex-1 overflow-auto py-2">
                    <nav class="grid items-start px-4 text-sm font-medium">
                        <div data-state="open" class="space-y-2">
                            <button type="button" aria-controls="radix-:Rcm:" aria-expanded="true" data-state="open"
                                    class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 transition-all hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-50">
                                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                                </svg>
                                课程库查看
                                <svg class="h-4 w-4 ml-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path d="m6 9 6 6 6-6"></path>
                                </svg>
                            </button>
                            <div data-state="open" id="radix-:Rcm:">
                                <div class="ml-4 space-y-2"><a
                                        class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 transition-all hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-50"
                                        href="/general">
                                    <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                         viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                         stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                                    </svg>
                                    通识模块</a><a
                                        class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 transition-all hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-50"
                                        href="/major">
                                    <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                         viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                         stroke-linecap="round" stroke-linejoin="round">
                                        <polygon
                                                points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                    </svg>
                                    专业模块</a></div>
                            </div>
                        </div>
                        <a class="flex items-center gap-3 rounded-lg bg-gray-100 px-3 py-2 text-gray-900 transition-all hover:text-gray-900 dark:bg-gray-800 dark:text-gray-50 dark:hover:text-gray-50"
                           href="/calculate">
                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <rect width="16" height="20" x="4" y="2" rx="2"></rect>
                                <line x1="8" x2="16" y1="6" y2="6"></line>
                                <line x1="16" x2="16" y1="14" y2="18"></line>
                                <path d="M16 10h.01"></path>
                                <path d="M12 10h.01"></path>
                                <path d="M8 10h.01"></path>
                                <path d="M12 14h.01"></path>
                                <path d="M8 14h.01"></path>
                                <path d="M12 18h.01"></path>
                                <path d="M8 18h.01"></path>
                            </svg>
                            计算学分</a></nav>
                </div>
            </div>
        </nav>
        <div class="flex flex-col">
            <main class="flex flex-1 flex-col gap-4 p-4 md:gap-6 md:p-6 relative">
                <div class="flex items-center"><h1 class="font-semibold text-lg md:text-2xl">课程</h1>
                    <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 ml-auto">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 3v12"></path>
                            <path d="m8 11 4 4 4-4"></path>
                            <path d="M8 5H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4"></path>
                        </svg>
                        <span class="sr-only">从文件导入</span></button>
                    <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-primary/90 h-9 rounded-md px-3 ml-2 bg-black text-white">
                        <a href="/minus">
                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14"></path>
                            </svg>
                        </a></button>
                    <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-primary/90 h-9 rounded-md px-3 ml-2 bg-black text-white">
                        <a href="/add">
                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14"></path>
                                <path d="M12 5v14"></path>
                            </svg>
                        </a></button>
                    <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-primary/90 h-9 rounded-md px-3 ml-2 bg-black text-white">
                        <a href="/download">
                            课程地图
                        </a>
                    </button>
                </div>
                <div class="flex items-center mb-4"><label class="mr-2">专业：</label><select
                        class="border rounded px-2 py-1 mr-4" id="major">
                    <option value="">选择一个选项</option>
                    {% for major in majors %}
                    <option value="{{major}}">{{major}}</option>
                    {% endfor %}
                </select><label class="mr-2" >模块：</label><select class="border rounded px-2 py-1 mr-4"
                                                                   id="category1">
                    <option value="">选择一个选项</option>
                    {% for category in allmodules[0]['categories'] %}
                    <option value="{{category.name}}" catatype=0>{{category.name}}</option>
                    {% endfor %}
                    {% for category in allmodules[1]['categories'] %}
                    <option value="{{category.name}}" catatype=1>{{category.name}}</option>
                    {% endfor %}
                </select><select class="border rounded px-2 py-1 mr-4" id="category2">
                </select>
                    <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-primary/90 h-9 rounded-md px-3 ml-auto bg-black text-white"
                            id="confirm-button">
                        确认
                    </button>
                </div>
                <div class="border shadow-sm rounded-lg">
                    <div class="relative w-full overflow-auto">
                        <table class="w-full caption-bottom text-sm">
                            <thead class="[&amp;_tr]:border-b">
                            <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                <th class="p-4 align-middle">
                                    <input class="form-check-input large-checkbox checkbox-class-all" type="checkbox" id="select-all" data-status="unchecked">
                                </th>
                                <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&amp;:has([role=checkbox])]:pr-0">
                                    课程名称
                                </th>
                                <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&amp;:has([role=checkbox])]:pr-0">
                                    课程编码
                                </th>
                                <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&amp;:has([role=checkbox])]:pr-0">
                                    课程学分
                                </th>
                                <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&amp;:has([role=checkbox])]:pr-0">
                                    开课学期
                                </th>
                                <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&amp;:has([role=checkbox])]:pr-0">
                                    模块小类
                                </th>
                            </tr>
                            </thead>
                            <tbody class="[&amp;_tr:last-child]:border-0">
                            {% for row in data %}
                            <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                <td class="p-4 align-middle [&amp;:has([role=checkbox])]:pr-0">
                                    <input class="form-check-input large-checkbox checkbox-class" type="checkbox" data-status="unchecked">
                                </td>
                                <td class="p-4 align-middle [&amp;:has([role=checkbox])]:pr-0" value="{{ row[0] }}">{{ row[0] }}</td>
                                <td class="p-4 align-middle [&amp;:has([role=checkbox])]:pr-0">{{ row[1] }}</td>
                                <td class="p-4 align-middle [&amp;:has([role=checkbox])]:pr-0">{{ row[2] }}</td>
                                <td class="p-4 align-middle [&amp;:has([role=checkbox])]:pr-0">{{ row[3]| process_semester }} </td>
                                <td class="p-4 align-middle [&amp;:has([role=checkbox])]:pr-0">{{ row[4] }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-primary/90 h-9 rounded-md px-3 bg-black text-white"
                            id="calculate-button">
                        计算学分
                    </button>
                    <span class="text-black">学分结果: <a id="score-result">0</a></span></div>
            </main>
        </div>
    </div>
</div>
<script type="text/javascript">
    var allmodules = {{ allmodules | tojson }} ;

    document.getElementById('category1').addEventListener('change', function () {
        var valueOne = this.value;
        var modules = allmodules[this.options[this.selectedIndex].getAttribute('catatype')].categories.find(cat => cat.name === valueOne).modules;
        var selectTwo = document.getElementById('category2');

        // 清空当前的选项
        selectTwo.innerHTML = '';

        // 添加新的选项
        var opt = document.createElement('option');
        opt.value = '';
        opt.innerHTML = '选择一个选项';
        if(modules.length>0) selectTwo.appendChild(opt);
        modules.forEach(function (module) {
            var opt = document.createElement('option');
            opt.value = module;
            opt.innerHTML = module;
            selectTwo.appendChild(opt);
        });
        if (this[0].value == '')
            this.remove(0);
    });

    document.getElementById('category1').addEventListener('change', function () {
        if (this[0].value == '')
            this.remove(0);
    });
    document.getElementById('category2').addEventListener('change', function () {
        if (this[0].value == '')
            this.remove(0);
    });

    document.getElementById('confirm-button').addEventListener('click', function () {
        var valueMajor = document.getElementById('major').value;
        var valueOne = document.getElementById('category1').value;
        var valueTwo = document.getElementById('category2').value;

        fetch('/process-selection', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                major: valueMajor,
                category: valueOne,
                module: valueTwo,
            })
        }).then(data => {
            window.location.reload();  // 然后重载页面
            console.log("专业:", valueMajor, "||模块:", valueOne, valueTwo);
        });
    });

    function handleCheckboxChange(checkbox) {
        if(checkbox.checked) {
            checkbox.setAttribute('data-status', 'checked');
        } else {
            checkbox.setAttribute('data-status', 'unchecked');
        }
    }

    // 获取 tbody 中所有的 checkbox
    var checkboxes = document.querySelectorAll('tbody .form-check-input');

    document.getElementById('select-all').addEventListener('change', function(){
        // 遍历并更新其它 checkbox 的状态
        checkboxes.forEach(function(checkbox) {
            if(checkbox.checked != document.getElementById('select-all').checked)checkbox.click();
        });
        handleCheckboxChange(this);
    });

    document.querySelectorAll('.checkbox-class').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            handleCheckboxChange(this);
        });
    });

    document.getElementById('calculate-button').addEventListener('click', function () {
        var scores=0;
        var rows = document.querySelectorAll('tbody tr');
        rows.forEach(function(row){
                // 获取tr中的所有td元素
                var cells = row.querySelectorAll('td');
                if (cells[0].querySelector("input").checked) scores+= parseInt(cells[3].innerText,10);
            }
        )
        document.getElementById("score-result").innerText=scores.toString();
    });
</script>
<script id="__NEXT_DATA__" type="application/json" crossorigin="">{
    "props": {
        "pageProps": {}
    },
    "page": "/calculate",
    "query": {},
    "buildId": "1zzyugYDExpvqP4ahtYCX",
    "nextExport": true,
    "autoExport": true,
    "isFallback": false,
    "scriptLoader": []
}</script>
</body>
</html>